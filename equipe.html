<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Equipe - TREES Lab</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">TREES Lab</a>
      <ul class="nav-menu">
        <li><a href="index.html" class="nav-link">In√≠cio</a></li>
        <li><a href="publicacoes.html" class="nav-link">Publica√ß√µes</a></li>
        <li><a href="equipe.html" class="nav-link active">Equipe</a></li>
      </ul>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero hero-small">
    <div class="hero-content">
      <h1>Nossa Equipe</h1>
      <p class="hero-subtitle">Conhe√ßa os pesquisadores e colaboradores do TREES Lab</p>
    </div>
  </section>

  <!-- Team Section -->
  <section class="section">
    <div class="container">
      <!-- Team Statistics -->
      <div class="section-header">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number" id="total-members">0</span>
            <span class="stat-label">Total de Membros</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="leaders-count">0</span>
            <span class="stat-label">L√≠deres</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="postdocs-count">0</span>
            <span class="stat-label">P√≥s-Doutorandos</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="students-count">0</span>
            <span class="stat-label">Estudantes</span>
          </div>
        </div>
      </div>

      <!-- Team Members by Category (Collapsible) -->
      <div id="team-container">
        <div class="loading">Carregando equipe...</div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <p>&copy; 2025 TREES Lab. Todos os direitos reservados.</p>
      <p>Grupo de Pesquisa em Sensoriamento Remoto e Ecologia</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    let teamData = [];

    const categoryLabels = {
      'leaders': 'L√≠deres de Pesquisa',
      'postdocs': 'P√≥s-Doutorandos',
      'phd': 'Doutorandos',
      'master': 'Mestrandos',
      'undergrad': 'Graduandos',
      'collaborators': 'Colaboradores',
      'former': 'Ex-Membros'
    };

    const categoryEmojis = {
      'leaders': 'üë®‚Äçüî¨',
      'postdocs': 'üéì',
      'phd': 'üìö',
      'master': 'üìñ',
      'undergrad': 'üéí',
      'collaborators': 'ü§ù',
      'former': 'üëã'
    };

    async function loadTeam() {
      try {
        console.log('Carregando equipe...');
        const response = await fetch('trees_lab_people_clean.csv');
        const text = await response.text();
        console.log('CSV carregado, tamanho:', text.length);
        const data = Papa.parse(text, { header: true, skipEmptyLines: true }).data;
        console.log('Dados parseados:', data.length, 'membros');
        
        teamData = data.filter(row => row.name && row.name.trim());
        console.log('Dados filtrados:', teamData.length, 'membros v√°lidos');
        
        renderTeam();
        updateStatistics();
        
      } catch (error) {
        console.error('Error loading team:', error);
        document.getElementById('team-container').innerHTML = 
          '<div class="loading">Erro ao carregar equipe.</div>';
      }
    }

    function renderTeam() {
      // Group team members by category
      const groupedByCategory = {};
      teamData.forEach(member => {
        const category = member.category || 'collaborators';
        if (!groupedByCategory[category]) {
          groupedByCategory[category] = [];
        }
        groupedByCategory[category].push(member);
      });

      // Order categories
      const categoryOrder = ['leaders', 'postdocs', 'phd', 'master', 'undergrad', 'collaborators', 'former'];
      const sortedCategories = categoryOrder.filter(cat => groupedByCategory[cat]);

      const container = document.getElementById('team-container');
      container.innerHTML = '';

      sortedCategories.forEach(category => {
        const members = groupedByCategory[category];
        const categoryLabel = categoryLabels[category] || category;
        const categoryEmoji = categoryEmojis[category] || 'üë§';
        
        // Create collapsible section
        const sectionHtml = `
          <div class="team-section">
            <button class="collapsible" onclick="toggleCollapsible(this)">
              <span>${categoryEmoji} ${categoryLabel} (${members.length})</span>
              <span class="collapsible-icon">‚ñº</span>
            </button>
            <div class="collapsible-content">
              <div class="collapsible-inner">
                <div class="team-grid">
                  ${members.map(member => renderMemberCard(member)).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
        
        container.innerHTML += sectionHtml;
      });

      // Auto-open leaders section
      const firstCollapsible = container.querySelector('.collapsible');
      if (firstCollapsible) {
        toggleCollapsible(firstCollapsible);
      }
    }

    function renderMemberCard(member) {
      // Use os campos corretos do CSV (em ingl√™s)
      const name = member.name || '';
      const category = member.category || '';
      const photo = member.photo || '';
      const research = member.research || '';
      const expertise = member.expertise || '';
      const linkedin = member.linkedin || '';
      const researchgate = member.researchgate || '';
      const orcid = member.orcid || '';
      
      // Mapear categorias para fun√ß√µes em portugu√™s
      const roleMap = {
        'leaders': 'L√≠der de Pesquisa',
        'postdocs': 'P√≥s-Doutorando',
        'phd': 'Doutorando',
        'master': 'Mestrando',
        'undergrad': 'Graduando',
        'collaborators': 'Colaborador',
        'former': 'Ex-Membro'
      };
      
      const role = roleMap[category] || 'Pesquisador';
      const initials = name ? name.split(' ').map(n => n[0]).join('').substring(0, 2) : '';

      return `
        <div class="team-card-modern">
          <div class="team-card-photo">
            ${photo ? `<img src="${photo}" alt="${name}" loading="lazy" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmNWY1ZjUiLz48Y2lyY2xlIGN4PSIxMDAiIGN5PSI4NSIgcj0iMzUiIGZpbGw9IiNkZGRkZGQiLz48cGF0aCBkPSJNNjAgMTYwYzAtMjIuMDkgMTcuOTEtNDAgNDAtNDBzNDAgMTcuOTEgNDAgNDB2NDBINjB2LTQweiIgZmlsbD0iI2RkZGRkZCIvPjwvc3ZnPg=='; this.style.display='block';">` : `<div class="photo-placeholder">${initials}</div>`}
            <div class="team-card-overlay">
              <div class="team-card-links">
                ${linkedin ? `<a href="${linkedin}" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a>` : ''}
                ${orcid ? `<a href="${orcid}" target="_blank" title="ORCID"><i class="fab fa-orcid"></i></a>` : ''}
                ${researchgate ? `<a href="${researchgate}" target="_blank" title="ResearchGate"><i class="fab fa-researchgate"></i></a>` : ''}
              </div>
            </div>
          </div>
          <div class="team-card-content">
            <h3 class="team-member-name">${name}</h3>
            <p class="team-member-role">${role}</p>
            ${research ? `<p class="team-member-bio">${truncateText(research, 120)}</p>` : ''}
            ${expertise ? `<div class="team-member-expertise"><strong>Especialidades:</strong> ${truncateText(expertise, 80)}</div>` : ''}
          </div>
        </div>
      `;
    }

    function truncateText(text, maxLength) {
      if (!text || typeof text !== 'string') return '';
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }

    function toggleCollapsible(button) {
      const content = button.nextElementSibling;
      const isActive = button.classList.contains('active');
      
      // Close all other collapsibles
      document.querySelectorAll('.collapsible').forEach(col => {
        col.classList.remove('active');
        col.nextElementSibling.classList.remove('active');
      });
      
      // Toggle current collapsible
      if (!isActive) {
        button.classList.add('active');
        content.classList.add('active');
      }
    }

    function updateStatistics() {
      const total = teamData.length;
      
      // Count by category
      const leaders = teamData.filter(member => member.category === 'leaders').length;
      const postdocs = teamData.filter(member => member.category === 'postdocs').length;
      const students = teamData.filter(member => 
        ['phd', 'master', 'undergrad'].includes(member.category)
      ).length;
      
      // Animate counters
      animateCounter('total-members', total);
      animateCounter('leaders-count', leaders);
      animateCounter('postdocs-count', postdocs);
      animateCounter('students-count', students);
    }

    function animateCounter(id, target) {
      const element = document.getElementById(id);
      let current = 0;
      const increment = target / 30;
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        element.textContent = Math.floor(current);
      }, 50);
    }

    // Scroll animations
    function initScrollAnimations() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      });

      document.querySelectorAll('.fade-in').forEach(el => {
        observer.observe(el);
      });
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      initScrollAnimations();
      loadTeam();
    });
  </script>
</body>
</html>
